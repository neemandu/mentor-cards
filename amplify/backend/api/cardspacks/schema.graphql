type Mutation {
  createUser(input: CreateUserInput!): User @function(name: "CreateUser-${env}")
  addCardsPack(input: addCardsPackInput!): Boolean @function(name: "AddCardsPack-${env}")
  changeCardsPack(input: changeCardsPackInput!): Boolean @function(name: "ChangeCardsPack-${env}")
  updatePaymentProgram(input: updatePaymentProgramInput!): Boolean @function(name: "UpdatePaymentProgram-${env}")
  updateGroupUsersList(input: groupUsersListInput!): Boolean @function(name: "UpdateGroupUsersList-${env}")
}

input groupUsersListInput {
  usernamesList: [String]
}

input updatePaymentProgramInput {
  paymentProgramId: String!
  providerTransactionId: String
}

input addCardsPackInput {
  cardsPackId: String
}

input changeCardsPackInput {
  oldCardsPackId: String
  newCardsPackId: String
}



input CreateUserInput {
  username: String
  email: AWSEmail
}

type CardsPack @model @auth( rules: [{ allow: private, operations: [read] }] ) {
  id: ID!
  imgUrl: String!
  description: String
  tags: [String]
  categories: [String]
  cards: [String] @function(name: "GetCardsImagesResolver-${env}")
  cardsPreview: [String] 
  usersIds: [String] 
  groupsIds: [String]
  users: [PackOwner] @connection(keyName: "byPack", fields: ["id"])
}

type PackOwner
  @auth( rules: [{ allow: private }] )
  @model(queries: null)
  @key(name: "byPack", fields: ["packID", "userID"])
  @key(name: "byOwner", fields: ["userID", "packID"]) {
  id: ID!
  packID: ID!
  userID: ID!
  pack: CardsPack! @connection(fields: ["packID"])
  owner: User! @connection(fields: ["userID"])
}

type User 
@model (mutations: null)
@auth( rules: [ { allow: owner, ownerField: "username", operations: [read, update] },
                { allow: private, operations: [create] }] ){
  id: ID!
  username: String!
  email: AWSEmail
  phone: String
  cardsPacks: [PackOwner] @connection(keyName: "byOwner", fields: ["id"])
  status: String
  subscription: MonthlySubscription 
  numberOfPacksSubstitutions: Int
  lastPackSubstitutionDate: AWSDateTime
  numberOfPlansSubstitutions: Int
  lastPlanSubstitutionDate: AWSDateTime
  groupId: Int
  isGroupOwner: Boolean
  groupUsers: [User] @connection
}

type MonthlySubscription {
  id: ID!
  startDate: AWSDateTime
  paymentProvider: String
  providerTransactionId: String
  subscriptionPlan: SubscriptionPlan 
}

type SubscriptionPlan @model @auth( rules: [{ allow: private}] ){
  id: ID!
  name: String
  description: String
  providerPlanId: String!
  numberOfUsers: Int
  numberOfCardPacks: Int
  price: Float
  discount: Float
}

